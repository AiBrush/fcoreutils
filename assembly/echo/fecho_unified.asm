; ============================================================
; fecho_unified.asm — AUTO-GENERATED unified file
; Hand-crafted ELF64 header — allows nasm -f bin (no linker)
; ============================================================
BITS 64
ORG 0x400000

; ── Constants ────────────────────────────────────────────────
%define SYS_WRITE       1
%define SYS_EXIT       60
%define STDOUT          1
%define STDERR          2
%define BUF_SIZE    65536

; ── ELF Header (64 bytes) ───────────────────────────────────
ehdr:
db 0x7f, 'E','L','F'       ; magic
db 2                        ; 64-bit
db 1                        ; little endian
db 1                        ; ELF version
db 0                        ; OS/ABI: System V
dq 0                        ; padding
dw 2                        ; ET_EXEC
dw 0x3e                     ; x86_64
dd 1                        ; ELF version
dq _start                   ; entry point
dq phdr - $$                ; program header offset
dq 0                        ; section header offset (none)
dd 0                        ; flags
dw 64                       ; ELF header size
dw 56                       ; program header entry size
dw 2                        ; 2 program headers
dw 64                       ; section header entry size
dw 0                        ; section header count
dw 0                        ; section name index

; ── Program Header: PT_LOAD (code+data+bss) ─────────────────
phdr:
dd 1                        ; PT_LOAD
dd 7                        ; PF_R | PF_W | PF_X
dq 0                        ; offset
dq $$                       ; virtual address
dq $$                       ; physical address
dq file_size                ; file size
dq file_size + bss_size     ; memory size (includes BSS)
dq 0x200000                 ; alignment

; ── Program Header: PT_GNU_STACK (NX stack) ──────────────────
dd 0x6474e551               ; PT_GNU_STACK
dd 6                        ; PF_R | PF_W (no execute)
dq 0
dq 0
dq 0
dq 0
dq 0
dq 0x10                     ; alignment

; ── Code Section ─────────────────────────────────────────────

; ──────────────────────────────────────────────────────────────
; asm_write(rdi=fd, rsi=buf, rdx=len) -> rax=0 on success, negative errno on error
; Retries on EINTR and handles short writes automatically
; ──────────────────────────────────────────────────────────────
asm_write:
    push    rbx
    push    r12
    push    r13
    mov     rbx, rdi        ; fd
    mov     r12, rsi        ; buf
    mov     r13, rdx        ; remaining len
.retry:
    mov     rax, SYS_WRITE
    mov     rdi, rbx
    mov     rsi, r12
    mov     rdx, r13
    syscall
    cmp     rax, -4         ; -EINTR?
    je      .retry
    test    rax, rax
    js      .error          ; negative = errno
    add     r12, rax        ; advance buffer pointer
    sub     r13, rax        ; decrease remaining
    jnz     .retry          ; short write — retry with remainder
    ; Success: all bytes written
    xor     eax, eax
    pop     r13
    pop     r12
    pop     rbx
    ret
.error:
    pop     r13
    pop     r12
    pop     rbx
    ret                     ; rax = negative errno

; ──────────────────────────────────────────────────────────────
; asm_exit(rdi=code) — never returns
; ──────────────────────────────────────────────────────────────
asm_exit:
    mov     rax, SYS_EXIT
    syscall

; ──────────────────────────────────────────────────────────────
; parse_echo_flags(rdi=argc, rsi=argv)
; Returns: rax = index of first non-flag arg, edx = flags byte
;   bit 0 = no_newline (-n), bit 1 = interpret_escapes (-e)
; ──────────────────────────────────────────────────────────────
parse_echo_flags:
    push    rbx
    push    r12
    push    r13
    push    r14

    mov     r12, rdi
    mov     r13, rsi
    xor     r14d, r14d
    mov     rbx, 1

.pef_next_arg:
    cmp     rbx, r12
    jge     .pef_done
    mov     rdi, [r13 + rbx * 8]
    cmp     byte [rdi], '-'
    jne     .pef_done
    cmp     byte [rdi + 1], 0
    je      .pef_done
    lea     rsi, [rdi + 1]
    mov     ecx, r14d

.pef_scan_char:
    movzx   eax, byte [rsi]
    test    al, al
    jz      .pef_flag_valid
    cmp     al, 'n'
    je      .pef_set_n
    cmp     al, 'e'
    je      .pef_set_e
    cmp     al, 'E'
    je      .pef_set_E
    jmp     .pef_done

.pef_set_n:
    or      ecx, 1
    inc     rsi
    jmp     .pef_scan_char
.pef_set_e:
    or      ecx, 2
    inc     rsi
    jmp     .pef_scan_char
.pef_set_E:
    and     ecx, ~2
    inc     rsi
    jmp     .pef_scan_char

.pef_flag_valid:
    mov     r14d, ecx
    inc     rbx
    jmp     .pef_next_arg

.pef_done:
    mov     rax, rbx
    mov     edx, r14d
    pop     r14
    pop     r13
    pop     r12
    pop     rbx
    ret

; ──────────────────────────────────────────────────────────────
; _start — main entry point
; ──────────────────────────────────────────────────────────────
_start:
    mov     r14, [rsp]
    lea     r15, [rsp + 8]

    ; Check for --help and --version (only when argc == 2)
    cmp     r14, 2
    jne     .normal_echo

    mov     rsi, [r15 + 8]          ; argv[1]

    ; Check for "--help"
    cmp     dword [rsi], 0x65682D2D ; "--he" (little-endian)
    jne     .chk_ver
    cmp     word [rsi+4], 0x706C    ; "lp"
    jne     .chk_ver
    cmp     byte [rsi+6], 0         ; null terminator
    jne     .chk_ver
    ; Matched --help -> print help_text and exit 0
    mov     rdi, STDOUT
    lea     rsi, [help_text]
    mov     edx, help_text_len
    call    asm_write
    xor     edi, edi
    call    asm_exit

.chk_ver:
    mov     rsi, [r15 + 8]          ; reload argv[1]
    ; Check for "--version"
    cmp     dword [rsi], 0x65762D2D ; "--ve" (little-endian)
    jne     .normal_echo
    cmp     dword [rsi+4], 0x6F697372 ; "rsio" (little-endian)
    jne     .normal_echo
    cmp     word [rsi+8], 0x006E    ; "n\0" (little-endian)
    jne     .normal_echo
    ; Matched --version -> print version_text and exit 0
    mov     rdi, STDOUT
    lea     rsi, [version_text]
    mov     edx, version_text_len
    call    asm_write
    xor     edi, edi
    call    asm_exit

.normal_echo:
    mov     rdi, r14
    mov     rsi, r15
    call    parse_echo_flags

    mov     r12, rax
    mov     r13d, edx
    mov     rbp, rax

    xor     ebx, ebx

    cmp     r12, r14
    jge     .write_output

    test    r13d, 2
    jnz     .escape_loop

; ── Fast path: no escape interpretation ──────────────────────
.fast_loop:
    cmp     r12, r14
    jge     .write_output

    cmp     r12, rbp
    je      .fast_no_space

    cmp     rbx, BUF_SIZE - 1
    jge     .flush_and_continue_fast
    mov     byte [out_buf + rbx], ' '
    inc     rbx

.fast_no_space:
    mov     rsi, [r15 + r12 * 8]

.fast_copy:
    movzx   eax, byte [rsi]
    test    al, al
    jz      .fast_next_arg

    cmp     rbx, BUF_SIZE - 1
    jge     .flush_and_continue_fast_copy

    mov     byte [out_buf + rbx], al
    inc     rbx
    inc     rsi
    jmp     .fast_copy

.fast_next_arg:
    inc     r12
    jmp     .fast_loop

; ── Slow path: escape interpretation ─────────────────────────
.escape_loop:
    cmp     r12, r14
    jge     .write_output

    cmp     r12, rbp
    je      .esc_no_space

    cmp     rbx, BUF_SIZE - 1
    jge     .flush_and_continue_esc
    mov     byte [out_buf + rbx], ' '
    inc     rbx

.esc_no_space:
    mov     rsi, [r15 + r12 * 8]

.esc_copy:
    movzx   eax, byte [rsi]
    test    al, al
    jz      .esc_next_arg

    cmp     al, '\'
    je      .handle_escape

    cmp     rbx, BUF_SIZE - 1
    jge     .flush_and_continue_esc_copy
    mov     byte [out_buf + rbx], al
    inc     rbx
    inc     rsi
    jmp     .esc_copy

.handle_escape:
    movzx   eax, byte [rsi + 1]
    test    al, al
    jz      .trailing_backslash

    cmp     al, '\'
    je      .esc_backslash
    cmp     al, 'a'
    je      .esc_alert
    cmp     al, 'b'
    je      .esc_backspace
    cmp     al, 'c'
    je      .esc_stop
    cmp     al, 'e'
    je      .esc_escape
    cmp     al, 'f'
    je      .esc_formfeed
    cmp     al, 'n'
    je      .esc_newline
    cmp     al, 'r'
    je      .esc_carriage
    cmp     al, 't'
    je      .esc_tab
    cmp     al, 'v'
    je      .esc_vtab
    cmp     al, '0'
    je      .esc_octal
    cmp     al, 'x'
    je      .esc_hex

    ; Unknown escape: output backslash + char
    cmp     rbx, BUF_SIZE - 2
    jge     .flush_and_continue_esc_copy
    mov     byte [out_buf + rbx], '\'
    inc     rbx
    mov     byte [out_buf + rbx], al
    inc     rbx
    add     rsi, 2
    jmp     .esc_copy

.trailing_backslash:
    cmp     rbx, BUF_SIZE - 1
    jge     .flush_and_continue_esc_copy
    mov     byte [out_buf + rbx], '\'
    inc     rbx
    inc     rsi
    jmp     .esc_copy

.esc_backslash:
    mov     cl, '\'
    jmp     .emit_esc_char
.esc_alert:
    mov     cl, 7
    jmp     .emit_esc_char
.esc_backspace:
    mov     cl, 8
    jmp     .emit_esc_char
.esc_escape:
    mov     cl, 27
    jmp     .emit_esc_char
.esc_formfeed:
    mov     cl, 12
    jmp     .emit_esc_char
.esc_newline:
    mov     cl, 10
    jmp     .emit_esc_char
.esc_carriage:
    mov     cl, 13
    jmp     .emit_esc_char
.esc_tab:
    mov     cl, 9
    jmp     .emit_esc_char
.esc_vtab:
    mov     cl, 11
    jmp     .emit_esc_char

.emit_esc_char:
    cmp     rbx, BUF_SIZE - 1
    jge     .flush_and_continue_esc_copy
    mov     byte [out_buf + rbx], cl
    inc     rbx
    add     rsi, 2
    jmp     .esc_copy

.esc_stop:
    jmp     .write_and_exit

.esc_octal:
    add     rsi, 2
    xor     ecx, ecx
    xor     edx, edx

.octal_digit:
    cmp     edx, 3
    jge     .octal_done
    movzx   eax, byte [rsi]
    sub     al, '0'
    cmp     al, 7
    ja      .octal_done
    shl     ecx, 3
    add     ecx, eax
    inc     rsi
    inc     edx
    jmp     .octal_digit

.octal_done:
    and     ecx, 0xFF
    cmp     rbx, BUF_SIZE - 1
    jge     .flush_and_continue_esc_copy
    mov     byte [out_buf + rbx], cl
    inc     rbx
    jmp     .esc_copy

.esc_hex:
    add     rsi, 2
    xor     ecx, ecx
    xor     edx, edx

.hex_digit:
    cmp     edx, 2
    jge     .hex_done
    movzx   eax, byte [rsi]

    cmp     al, '0'
    jb      .hex_check_no_digits
    cmp     al, '9'
    jbe     .hex_digit_09
    cmp     al, 'a'
    jb      .hex_check_upper
    cmp     al, 'f'
    jbe     .hex_digit_af
.hex_check_upper:
    cmp     al, 'A'
    jb      .hex_check_no_digits
    cmp     al, 'F'
    jbe     .hex_digit_AF

.hex_check_no_digits:
    test    edx, edx
    jz      .hex_no_digits
    jmp     .hex_done

.hex_digit_09:
    sub     al, '0'
    jmp     .hex_accumulate
.hex_digit_af:
    sub     al, 'a'
    add     al, 10
    jmp     .hex_accumulate
.hex_digit_AF:
    sub     al, 'A'
    add     al, 10
.hex_accumulate:
    shl     ecx, 4
    add     ecx, eax
    inc     rsi
    inc     edx
    jmp     .hex_digit

.hex_no_digits:
    cmp     rbx, BUF_SIZE - 2
    jge     .flush_and_continue_esc_copy
    mov     byte [out_buf + rbx], '\'
    inc     rbx
    mov     byte [out_buf + rbx], 'x'
    inc     rbx
    jmp     .esc_copy

.hex_done:
    and     ecx, 0xFF
    cmp     rbx, BUF_SIZE - 1
    jge     .flush_and_continue_esc_copy
    mov     byte [out_buf + rbx], cl
    inc     rbx
    jmp     .esc_copy

.esc_next_arg:
    inc     r12
    jmp     .escape_loop

; ── Output ───────────────────────────────────────────────────
.write_output:
    test    r13d, 1
    jnz     .write_and_exit

    cmp     rbx, BUF_SIZE - 1
    jge     .flush_then_newline
    mov     byte [out_buf + rbx], 10
    inc     rbx

.write_and_exit:
    test    rbx, rbx
    jz      .exit_0

    mov     rdi, STDOUT
    lea     rsi, [out_buf]
    mov     rdx, rbx
    call    asm_write

    ; Check for write error — exit 1 on failure (matches GNU)
    test    rax, rax
    js      .exit_1

.exit_0:
    xor     edi, edi
    call    asm_exit

.exit_1:
    mov     edi, 1
    call    asm_exit

; ── Flush helpers ────────────────────────────────────────────
.do_flush:
    mov     rdi, STDOUT
    lea     rsi, [out_buf]
    mov     rdx, rbx
    call    asm_write
    test    rax, rax
    js      .exit_1             ; exit 1 on flush error
    xor     ebx, ebx
    ret

.flush_and_continue_fast:
    push    rsi
    call    .do_flush
    pop     rsi
    mov     byte [out_buf + rbx], ' '
    inc     rbx
    jmp     .fast_no_space

.flush_and_continue_fast_copy:
    push    rsi
    call    .do_flush
    pop     rsi
    jmp     .fast_copy

.flush_and_continue_esc:
    push    rsi
    call    .do_flush
    pop     rsi
    mov     byte [out_buf + rbx], ' '
    inc     rbx
    jmp     .esc_no_space

.flush_and_continue_esc_copy:
    push    rsi
    call    .do_flush
    pop     rsi
    jmp     .esc_copy

.flush_then_newline:
    call    .do_flush
    mov     byte [out_buf], 10
    inc     rbx
    jmp     .write_and_exit

; ── Data: help and version text ──────────────────────────────
; @@DATA_START@@
help_text:
    db 0x55, 0x73, 0x61, 0x67, 0x65, 0x3a, 0x20, 0x65, 0x63, 0x68, 0x6f, 0x20, 0x5b, 0x53, 0x48, 0x4f, 0x52, 0x54, 0x2d, 0x4f, 0x50, 0x54, 0x49, 0x4f, 0x4e, 0x5d, 0x2e, 0x2e, 0x2e, 0x20, 0x5b, 0x53, 0x54, 0x52, 0x49, 0x4e, 0x47, 0x5d, 0x2e, 0x2e, 0x2e, 0x0a
    db 0x20, 0x20, 0x6f, 0x72, 0x3a, 0x20, 0x20, 0x65, 0x63, 0x68, 0x6f, 0x20, 0x4c, 0x4f, 0x4e, 0x47, 0x2d, 0x4f, 0x50, 0x54, 0x49, 0x4f, 0x4e, 0x0a
    db 0x45, 0x63, 0x68, 0x6f, 0x20, 0x74, 0x68, 0x65, 0x20, 0x53, 0x54, 0x52, 0x49, 0x4e, 0x47, 0x28, 0x73, 0x29, 0x20, 0x74, 0x6f, 0x20, 0x73, 0x74, 0x61, 0x6e, 0x64, 0x61, 0x72, 0x64, 0x20, 0x6f, 0x75, 0x74, 0x70, 0x75, 0x74, 0x2e, 0x0a
    db 0x0a
    db 0x20, 0x20, 0x2d, 0x6e, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x64, 0x6f, 0x20, 0x6e, 0x6f, 0x74, 0x20, 0x6f, 0x75, 0x74, 0x70, 0x75, 0x74, 0x20, 0x74, 0x68, 0x65, 0x20, 0x74, 0x72, 0x61, 0x69, 0x6c, 0x69, 0x6e, 0x67, 0x20, 0x6e, 0x65, 0x77, 0x6c, 0x69, 0x6e, 0x65, 0x0a
    db 0x20, 0x20, 0x2d, 0x65, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x65, 0x6e, 0x61, 0x62, 0x6c, 0x65, 0x20, 0x69, 0x6e, 0x74, 0x65, 0x72, 0x70, 0x72, 0x65, 0x74, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x6f, 0x66, 0x20, 0x62, 0x61, 0x63, 0x6b, 0x73, 0x6c, 0x61, 0x73, 0x68, 0x20, 0x65, 0x73, 0x63, 0x61, 0x70, 0x65, 0x73, 0x0a
    db 0x20, 0x20, 0x2d, 0x45, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x64, 0x69, 0x73, 0x61, 0x62, 0x6c, 0x65, 0x20, 0x69, 0x6e, 0x74, 0x65, 0x72, 0x70, 0x72, 0x65, 0x74, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x6f, 0x66, 0x20, 0x62, 0x61, 0x63, 0x6b, 0x73, 0x6c, 0x61, 0x73, 0x68, 0x20, 0x65, 0x73, 0x63, 0x61, 0x70, 0x65, 0x73, 0x20, 0x28, 0x64, 0x65, 0x66, 0x61, 0x75, 0x6c, 0x74, 0x29, 0x0a
    db 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x2d, 0x2d, 0x68, 0x65, 0x6c, 0x70, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x64, 0x69, 0x73, 0x70, 0x6c, 0x61, 0x79, 0x20, 0x74, 0x68, 0x69, 0x73, 0x20, 0x68, 0x65, 0x6c, 0x70, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x65, 0x78, 0x69, 0x74, 0x0a
    db 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x2d, 0x2d, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x20, 0x20, 0x20, 0x20, 0x6f, 0x75, 0x74, 0x70, 0x75, 0x74, 0x20, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x69, 0x6e, 0x66, 0x6f, 0x72, 0x6d, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x65, 0x78, 0x69, 0x74, 0x0a
    db 0x0a
    db 0x49, 0x66, 0x20, 0x2d, 0x65, 0x20, 0x69, 0x73, 0x20, 0x69, 0x6e, 0x20, 0x65, 0x66, 0x66, 0x65, 0x63, 0x74, 0x2c, 0x20, 0x74, 0x68, 0x65, 0x20, 0x66, 0x6f, 0x6c, 0x6c, 0x6f, 0x77, 0x69, 0x6e, 0x67, 0x20, 0x73, 0x65, 0x71, 0x75, 0x65, 0x6e, 0x63, 0x65, 0x73, 0x20, 0x61, 0x72, 0x65, 0x20, 0x72, 0x65, 0x63, 0x6f, 0x67, 0x6e, 0x69, 0x7a, 0x65, 0x64, 0x3a, 0x0a
    db 0x0a
    db 0x20, 0x20, 0x5c, 0x5c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x62, 0x61, 0x63, 0x6b, 0x73, 0x6c, 0x61, 0x73, 0x68, 0x0a
    db 0x20, 0x20, 0x5c, 0x61, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x61, 0x6c, 0x65, 0x72, 0x74, 0x20, 0x28, 0x42, 0x45, 0x4c, 0x29, 0x0a
    db 0x20, 0x20, 0x5c, 0x62, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x62, 0x61, 0x63, 0x6b, 0x73, 0x70, 0x61, 0x63, 0x65, 0x0a
    db 0x20, 0x20, 0x5c, 0x63, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x70, 0x72, 0x6f, 0x64, 0x75, 0x63, 0x65, 0x20, 0x6e, 0x6f, 0x20, 0x66, 0x75, 0x72, 0x74, 0x68, 0x65, 0x72, 0x20, 0x6f, 0x75, 0x74, 0x70, 0x75, 0x74, 0x0a
    db 0x20, 0x20, 0x5c, 0x65, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x65, 0x73, 0x63, 0x61, 0x70, 0x65, 0x0a
    db 0x20, 0x20, 0x5c, 0x66, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x66, 0x6f, 0x72, 0x6d, 0x20, 0x66, 0x65, 0x65, 0x64, 0x0a
    db 0x20, 0x20, 0x5c, 0x6e, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x6e, 0x65, 0x77, 0x20, 0x6c, 0x69, 0x6e, 0x65, 0x0a
    db 0x20, 0x20, 0x5c, 0x72, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x63, 0x61, 0x72, 0x72, 0x69, 0x61, 0x67, 0x65, 0x20, 0x72, 0x65, 0x74, 0x75, 0x72, 0x6e, 0x0a
    db 0x20, 0x20, 0x5c, 0x74, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x68, 0x6f, 0x72, 0x69, 0x7a, 0x6f, 0x6e, 0x74, 0x61, 0x6c, 0x20, 0x74, 0x61, 0x62, 0x0a
    db 0x20, 0x20, 0x5c, 0x76, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x76, 0x65, 0x72, 0x74, 0x69, 0x63, 0x61, 0x6c, 0x20, 0x74, 0x61, 0x62, 0x0a
    db 0x20, 0x20, 0x5c, 0x30, 0x4e, 0x4e, 0x4e, 0x20, 0x20, 0x20, 0x62, 0x79, 0x74, 0x65, 0x20, 0x77, 0x69, 0x74, 0x68, 0x20, 0x6f, 0x63, 0x74, 0x61, 0x6c, 0x20, 0x76, 0x61, 0x6c, 0x75, 0x65, 0x20, 0x4e, 0x4e, 0x4e, 0x20, 0x28, 0x31, 0x20, 0x74, 0x6f, 0x20, 0x33, 0x20, 0x64, 0x69, 0x67, 0x69, 0x74, 0x73, 0x29, 0x0a
    db 0x20, 0x20, 0x5c, 0x78, 0x48, 0x48, 0x20, 0x20, 0x20, 0x20, 0x62, 0x79, 0x74, 0x65, 0x20, 0x77, 0x69, 0x74, 0x68, 0x20, 0x68, 0x65, 0x78, 0x61, 0x64, 0x65, 0x63, 0x69, 0x6d, 0x61, 0x6c, 0x20, 0x76, 0x61, 0x6c, 0x75, 0x65, 0x20, 0x48, 0x48, 0x20, 0x28, 0x31, 0x20, 0x74, 0x6f, 0x20, 0x32, 0x20, 0x64, 0x69, 0x67, 0x69, 0x74, 0x73, 0x29, 0x0a
    db 0x0a
    db 0x59, 0x6f, 0x75, 0x72, 0x20, 0x73, 0x68, 0x65, 0x6c, 0x6c, 0x20, 0x6d, 0x61, 0x79, 0x20, 0x68, 0x61, 0x76, 0x65, 0x20, 0x69, 0x74, 0x73, 0x20, 0x6f, 0x77, 0x6e, 0x20, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x6f, 0x66, 0x20, 0x65, 0x63, 0x68, 0x6f, 0x2c, 0x20, 0x77, 0x68, 0x69, 0x63, 0x68, 0x20, 0x75, 0x73, 0x75, 0x61, 0x6c, 0x6c, 0x79, 0x20, 0x73, 0x75, 0x70, 0x65, 0x72, 0x73, 0x65, 0x64, 0x65, 0x73, 0x0a
    db 0x74, 0x68, 0x65, 0x20, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x64, 0x65, 0x73, 0x63, 0x72, 0x69, 0x62, 0x65, 0x64, 0x20, 0x68, 0x65, 0x72, 0x65, 0x2e, 0x20, 0x20, 0x50, 0x6c, 0x65, 0x61, 0x73, 0x65, 0x20, 0x72, 0x65, 0x66, 0x65, 0x72, 0x20, 0x74, 0x6f, 0x20, 0x79, 0x6f, 0x75, 0x72, 0x20, 0x73, 0x68, 0x65, 0x6c, 0x6c, 0x27, 0x73, 0x20, 0x64, 0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x0a
    db 0x66, 0x6f, 0x72, 0x20, 0x64, 0x65, 0x74, 0x61, 0x69, 0x6c, 0x73, 0x20, 0x61, 0x62, 0x6f, 0x75, 0x74, 0x20, 0x74, 0x68, 0x65, 0x20, 0x6f, 0x70, 0x74, 0x69, 0x6f, 0x6e, 0x73, 0x20, 0x69, 0x74, 0x20, 0x73, 0x75, 0x70, 0x70, 0x6f, 0x72, 0x74, 0x73, 0x2e, 0x0a
    db 0x0a
    db 0x43, 0x6f, 0x6e, 0x73, 0x69, 0x64, 0x65, 0x72, 0x20, 0x75, 0x73, 0x69, 0x6e, 0x67, 0x20, 0x74, 0x68, 0x65, 0x20, 0x70, 0x72, 0x69, 0x6e, 0x74, 0x66, 0x28, 0x31, 0x29, 0x20, 0x63, 0x6f, 0x6d, 0x6d, 0x61, 0x6e, 0x64, 0x20, 0x69, 0x6e, 0x73, 0x74, 0x65, 0x61, 0x64, 0x2c, 0x0a
    db 0x61, 0x73, 0x20, 0x69, 0x74, 0x20, 0x61, 0x76, 0x6f, 0x69, 0x64, 0x73, 0x20, 0x70, 0x72, 0x6f, 0x62, 0x6c, 0x65, 0x6d, 0x73, 0x20, 0x77, 0x68, 0x65, 0x6e, 0x20, 0x6f, 0x75, 0x74, 0x70, 0x75, 0x74, 0x74, 0x69, 0x6e, 0x67, 0x20, 0x6f, 0x70, 0x74, 0x69, 0x6f, 0x6e, 0x2d, 0x6c, 0x69, 0x6b, 0x65, 0x20, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x73, 0x2e, 0x0a
    db 0x0a
    db 0x47, 0x4e, 0x55, 0x20, 0x63, 0x6f, 0x72, 0x65, 0x75, 0x74, 0x69, 0x6c, 0x73, 0x20, 0x6f, 0x6e, 0x6c, 0x69, 0x6e, 0x65, 0x20, 0x68, 0x65, 0x6c, 0x70, 0x3a, 0x20, 0x3c, 0x68, 0x74, 0x74, 0x70, 0x73, 0x3a, 0x2f, 0x2f, 0x77, 0x77, 0x77, 0x2e, 0x67, 0x6e, 0x75, 0x2e, 0x6f, 0x72, 0x67, 0x2f, 0x73, 0x6f, 0x66, 0x74, 0x77, 0x61, 0x72, 0x65, 0x2f, 0x63, 0x6f, 0x72, 0x65, 0x75, 0x74, 0x69, 0x6c, 0x73, 0x2f, 0x3e, 0x0a
    db 0x46, 0x75, 0x6c, 0x6c, 0x20, 0x64, 0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x3c, 0x68, 0x74, 0x74, 0x70, 0x73, 0x3a, 0x2f, 0x2f, 0x77, 0x77, 0x77, 0x2e, 0x67, 0x6e, 0x75, 0x2e, 0x6f, 0x72, 0x67, 0x2f, 0x73, 0x6f, 0x66, 0x74, 0x77, 0x61, 0x72, 0x65, 0x2f, 0x63, 0x6f, 0x72, 0x65, 0x75, 0x74, 0x69, 0x6c, 0x73, 0x2f, 0x65, 0x63, 0x68, 0x6f, 0x3e, 0x0a
    db 0x6f, 0x72, 0x20, 0x61, 0x76, 0x61, 0x69, 0x6c, 0x61, 0x62, 0x6c, 0x65, 0x20, 0x6c, 0x6f, 0x63, 0x61, 0x6c, 0x6c, 0x79, 0x20, 0x76, 0x69, 0x61, 0x3a, 0x20, 0x69, 0x6e, 0x66, 0x6f, 0x20, 0x27, 0x28, 0x63, 0x6f, 0x72, 0x65, 0x75, 0x74, 0x69, 0x6c, 0x73, 0x29, 0x20, 0x65, 0x63, 0x68, 0x6f, 0x20, 0x69, 0x6e, 0x76, 0x6f, 0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x27, 0x0a
help_text_len equ $ - help_text

version_text:
    db 0x65, 0x63, 0x68, 0x6f, 0x20, 0x28, 0x47, 0x4e, 0x55, 0x20, 0x63, 0x6f, 0x72, 0x65, 0x75, 0x74, 0x69, 0x6c, 0x73, 0x29, 0x20, 0x39, 0x2e, 0x37, 0x0a
    db 0x50, 0x61, 0x63, 0x6b, 0x61, 0x67, 0x65, 0x64, 0x20, 0x62, 0x79, 0x20, 0x44, 0x65, 0x62, 0x69, 0x61, 0x6e, 0x20, 0x28, 0x39, 0x2e, 0x37, 0x2d, 0x33, 0x29, 0x0a
    db 0x43, 0x6f, 0x70, 0x79, 0x72, 0x69, 0x67, 0x68, 0x74, 0x20, 0x28, 0x43, 0x29, 0x20, 0x32, 0x30, 0x32, 0x35, 0x20, 0x46, 0x72, 0x65, 0x65, 0x20, 0x53, 0x6f, 0x66, 0x74, 0x77, 0x61, 0x72, 0x65, 0x20, 0x46, 0x6f, 0x75, 0x6e, 0x64, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x2c, 0x20, 0x49, 0x6e, 0x63, 0x2e, 0x0a
    db 0x4c, 0x69, 0x63, 0x65, 0x6e, 0x73, 0x65, 0x20, 0x47, 0x50, 0x4c, 0x76, 0x33, 0x2b, 0x3a, 0x20, 0x47, 0x4e, 0x55, 0x20, 0x47, 0x50, 0x4c, 0x20, 0x76, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x33, 0x20, 0x6f, 0x72, 0x20, 0x6c, 0x61, 0x74, 0x65, 0x72, 0x20, 0x3c, 0x68, 0x74, 0x74, 0x70, 0x73, 0x3a, 0x2f, 0x2f, 0x67, 0x6e, 0x75, 0x2e, 0x6f, 0x72, 0x67, 0x2f, 0x6c, 0x69, 0x63, 0x65, 0x6e, 0x73, 0x65, 0x73, 0x2f, 0x67, 0x70, 0x6c, 0x2e, 0x68, 0x74, 0x6d, 0x6c, 0x3e, 0x2e, 0x0a
    db 0x54, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x66, 0x72, 0x65, 0x65, 0x20, 0x73, 0x6f, 0x66, 0x74, 0x77, 0x61, 0x72, 0x65, 0x3a, 0x20, 0x79, 0x6f, 0x75, 0x20, 0x61, 0x72, 0x65, 0x20, 0x66, 0x72, 0x65, 0x65, 0x20, 0x74, 0x6f, 0x20, 0x63, 0x68, 0x61, 0x6e, 0x67, 0x65, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x72, 0x65, 0x64, 0x69, 0x73, 0x74, 0x72, 0x69, 0x62, 0x75, 0x74, 0x65, 0x20, 0x69, 0x74, 0x2e, 0x0a
    db 0x54, 0x68, 0x65, 0x72, 0x65, 0x20, 0x69, 0x73, 0x20, 0x4e, 0x4f, 0x20, 0x57, 0x41, 0x52, 0x52, 0x41, 0x4e, 0x54, 0x59, 0x2c, 0x20, 0x74, 0x6f, 0x20, 0x74, 0x68, 0x65, 0x20, 0x65, 0x78, 0x74, 0x65, 0x6e, 0x74, 0x20, 0x70, 0x65, 0x72, 0x6d, 0x69, 0x74, 0x74, 0x65, 0x64, 0x20, 0x62, 0x79, 0x20, 0x6c, 0x61, 0x77, 0x2e, 0x0a
    db 0x0a
    db 0x57, 0x72, 0x69, 0x74, 0x74, 0x65, 0x6e, 0x20, 0x62, 0x79, 0x20, 0x42, 0x72, 0x69, 0x61, 0x6e, 0x20, 0x46, 0x6f, 0x78, 0x20, 0x61, 0x6e, 0x64, 0x20, 0x43, 0x68, 0x65, 0x74, 0x20, 0x52, 0x61, 0x6d, 0x65, 0x79, 0x2e, 0x0a
version_text_len equ $ - version_text
; @@DATA_END@@

; ── End of code ──────────────────────────────────────────────
file_size equ $ - $$

; ── BSS (not in file, allocated in memory) ───────────────────
out_buf equ $$ + file_size
bss_size equ BUF_SIZE
